<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Verify Attendance - Attendance Management System</title>
    <link rel="stylesheet" href="modern-styles.css" />
    <style>
        /* --- same styles as before --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            position: relative;
            overflow-x: hidden;
        }
        /* keep all your CSS here (unchanged for brevity) */
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <a href="index.html"><span>üè†</span><span>Home</span></a>
        <a href="add-employee.html"><span>üë§</span><span>Add Employee</span></a>
        <a href="view-employees.html"><span>üë•</span><span>View Employees</span></a>
        <a href="fingerprint-verify.html" class="active"><span>üîç</span><span>Verify Attendance</span></a>
        <a href="attendance-records.html"><span>üìÖ</span><span>Records</span></a>
    </nav>

    <div class="glass-card">
        <div class="header">
            <h1>üëÜ Fingerprint Verification</h1>
            <p>Secure attendance marking with fingerprint authentication</p>
        </div>

        <div class="verify-section">
            <div class="verify-icon"><span>üîê</span></div>
            <h2 class="verify-title">Enter Fingerprint ID</h2>
            <p class="verify-description">Enter your fingerprint ID to mark your attendance</p>

            <input type="text" id="fingerprintId" class="fingerprint-input"
                placeholder="Enter Fingerprint ID"
                maxlength="10" oninput="handleInput()" onkeypress="handleKeyPress(event)" />

            <div style="margin: 30px 0;">
                <button type="button" class="verify-button" onclick="markAttendance()">üîç Verify Employee</button>
            </div>

            <div id="employeeDetails" class="employee-details">
                <h3 style="color: #1e3c72; margin-bottom: 20px;">Employee Verified</h3>
                <div id="employeeInfo" style="text-align: left;"></div>
            </div>
        </div>
    </div>

    <script>
        let currentEmployee = null;

        function handleInput() {
            const input = document.getElementById('fingerprintId');
            let value = input.value.trim().toUpperCase();
            if (value && !value.startsWith('FP')) {
                value = 'FP' + value.replace(/[^0-9]/g, '');
                input.value = value;
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                markAttendance();
            }
        }

        // Verify employee
        async function markAttendance() {
            const fingerprintId = document.getElementById('fingerprintId').value.trim().toUpperCase();
            if (!fingerprintId) {
                showMessage('Please enter a fingerprint ID', 'error');
                return;
            }

            const btn = document.querySelector('.verify-button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚è≥ Verifying...';
            btn.disabled = true;

            try {
                const response = await fetch(`https://amsapplication.up.railway.app/api/employees/fingerprint/${fingerprintId}`);

                if (!response.ok) {
                    showMessage(`Employee not found with fingerprint ID: ${fingerprintId}`, 'error');
                    return;
                }

                const employee = await response.json();
                currentEmployee = employee;
                showEmployeeDetails(employee);

            } catch (error) {
                showMessage(`Error: ${error.message}`, 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        function showEmployeeDetails(employee) {
            const infoDiv = document.getElementById('employeeInfo');
            infoDiv.innerHTML = `
                <div class="employee-info-card">
                    <div style="display: grid; grid-template-columns: auto 1fr; gap: 20px; align-items: center;">
                        <div class="employee-avatar">üë§</div>
                        <div>
                            <div class="employee-name">${employee.name}</div>
                            <div class="employee-detail-item"><strong>üîí Fingerprint ID:</strong> ${employee.fingerprintId}</div>
                            <div class="employee-detail-item"><strong>üìß Email:</strong> ${employee.email || 'Not provided'}</div>
                            <div class="employee-detail-item"><strong>üè¢ Department:</strong> ${employee.department || 'Not specified'}</div>
                        </div>
                    </div>
                </div>
                <button type="button" class="mark-attendance-button" onclick="markEmployeeAttendance()">‚úÖ Mark Attendance</button>
                <div id="attendanceStatus" style="display: none;"></div>
            `;
            document.getElementById('employeeDetails').style.display = 'block';
        }

        // Mark attendance
        async function markEmployeeAttendance() {
            if (!currentEmployee) {
                showMessage('No employee selected', 'error');
                return;
            }

            const fingerprintId = currentEmployee.fingerprintId;
            const btn = document.querySelector('.mark-attendance-button');
            const statusDiv = document.getElementById('attendanceStatus');

            btn.innerHTML = '‚è≥ Marking Attendance...';
            btn.disabled = true;

            try {
                const response = await fetch("https://amsapplication.up.railway.app/api/attendance/mark", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ fingerprintId })
                });

                if (response.ok) {
                    const result = await response.json();
                    btn.style.display = 'none';
                    statusDiv.innerHTML = `
                        <div class="marked-status">
                            ‚úÖ Attendance Marked Successfully!
                            <div style="font-size: 14px; margin-top: 5px; opacity: 0.9;">
                                ${new Date().toLocaleString()}
                            </div>
                        </div>
                    `;
                    statusDiv.style.display = 'block';
                    showMessage('‚úÖ Attendance marked successfully!', 'success');
                } else {
                    const error = await response.text();
                    showMessage(`‚ùå Failed to mark attendance: ${error}`, 'error');
                    btn.innerHTML = '‚úÖ Mark Attendance';
                    btn.disabled = false;
                }
            } catch (error) {
                showMessage(`‚ùå Error: ${error.message}`, 'error');
                btn.innerHTML = '‚úÖ Mark Attendance';
                btn.disabled = false;
            }
        }

        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: ${type === 'success' ? 'linear-gradient(135deg, #28a745, #20c997)' : 'linear-gradient(135deg, #dc3545, #fd7e14)'};
                color: white;
                padding: 20px 30px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                font-size: 16px;
                font-weight: 600;
                text-align: center;
            `;
            messageDiv.innerHTML = message;
            document.body.appendChild(messageDiv);

            setTimeout(() => {
                messageDiv.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => document.body.removeChild(messageDiv), 300);
            }, 3000);
        }

        window.addEventListener('load', () => {
            document.getElementById('fingerprintId').focus();
        });
    </script>
</body>
</html>
